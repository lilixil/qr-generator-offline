
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FQKQL5Y7ME"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FQKQL5Y7ME');
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Generator</title>
  <script src="qrcode.min.js"></script>
  <style>
    /* Your existing CSS remains unchanged */
  </style>
</head>
<body>
  <div class="container">
    <div class="theme-switch">
      <button class="theme-switch-button" id="theme-toggle" title="Toggle dark mode">
        <svg class="theme-switch-icon" id="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
      </button>
    </div>
    <h1>QR Code Generator</h1>
    <div class="input-group">
      <input 
        type="text" 
        id="text-input" 
        placeholder="Enter text to generate QR..."
        maxlength="500"
        autofocus
      >
    </div>
    <div id="qrcode"></div>
    <div class="button-group">
      <button id="copy-button" class="copy-button">Copy to Clipboard</button>
      <button id="download-button" class="copy-button">Download QR Code</button>
    </div>
  </div>

  <script>
    const textInput = document.getElementById('text-input');
    const qrcodeContainer = document.getElementById('qrcode');
    const copyButton = document.getElementById('copy-button');
    const downloadButton = document.getElementById('download-button');
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    let qr = null;

    // Theme switching (unchanged)
    function setTheme(isDark) { /*...*/ }
    function updateThemeIcon(isDark) { /*...*/ }
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('dark-mode');
    const isDark = savedTheme !== null ? savedTheme === 'true' : prefersDark;
    setTheme(isDark);
    themeToggle.addEventListener('click', () => { /*...*/ });

    // Generate QR Code
    function generateQRCode(text) {
      qrcodeContainer.innerHTML = '';
      if (text.trim() !== '') {
        qr = new QRCode(qrcodeContainer, {
          text: text,
          width: 256,
          height: 256,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
      }
    }

    // Copy QR Code to Clipboard
    async function copyQRToClipboard() { /* (unchanged) */ }
    copyButton.addEventListener('click', copyQRToClipboard);

    // Download QR Code
    function downloadQR() {
      const qrImage = qrcodeContainer.querySelector('img');
      if (qrImage) {
        const link = document.createElement('a');
        link.href = qrImage.src;
        link.download = 'qr-code.png';
        link.click();
      }
    }
    downloadButton.addEventListener('click', downloadQR);

    // Update button visibility
    function updateCopyButtonVisibility(text) {
      copyButton.classList.toggle('visible', text.trim() !== '');
      downloadButton.classList.toggle('visible', text.trim() !== '');
    }

    // Handle text input changes
    textInput.addEventListener('input', (e) => {
      const text = e.target.value;
      generateQRCode(text);
      updateCopyButtonVisibility(text);

      // Track event in Google Analytics
      gtag('event', 'generate_qr', {
        event_category: 'QR Code Generator',
        event_label: 'Text input updated',
        value: text.length
      });
    });

    // Generate initial QR code if input is not empty
    if (textInput.value) {
      generateQRCode(textInput.value);
      updateCopyButtonVisibility(textInput.value);
    }
  </script>
</body>
</html>
